import{b as j,r as u,A as N,u as g,j as e,x as z,n as L,a as v,M as P,H as I,P as A,S as O,T as $,U,_ as b}from"./index-cdc06e8f.js";import{I as F,D,h as M,i as B,H}from"./index.esm-0fe4b9cd.js";import{s as V}from"./main-a582b553.js";function W(){const{i18n:t,t:s}=j("sign page"),i=t.language,n=u.useCallback(a=>i==="en"?a.FullName.split("/")[0]:a.EmpName,[i]);return{id2name:u.useCallback(a=>a?async function(){const l=await N.getMember(a);return n(l[0])}():s("noDeputy"),[n,s]),splitName:n}}const S=({title:t,content:s,className:i})=>e.jsxs("div",{className:`${i} grid grid-cols-2 items-center justify-center gap-2`,children:[e.jsxs("span",{className:"text-end",children:[t," :"]}),e.jsx("span",{children:s})]}),ue=({type:t,data:s})=>{const{i18n:i,t:n}=j(["common","new form"]),c=i.language,a=g(f=>f.nowUser).body,{splitName:l}=W();return e.jsxs("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsx(S,{title:n("info.id",{ns:"new form"}),content:t==="addForm"?n("auto"):s==null?void 0:s.id}),e.jsx(S,{title:n("info.date",{ns:"new form"}),content:t==="addForm"?z(new Date):s==null?void 0:s.createDate}),e.jsx(S,{title:n("info.status",{ns:"new form"}),content:t==="addForm"?n("signStatus.no",{ns:"common"}):s==null?void 0:s.status}),e.jsx(S,{title:n("info.comp",{ns:"new form"}),content:t==="addForm"?c==="en"?a.ResourcesName_E:a.ResourcesName:s==null?void 0:s.company}),e.jsx(S,{title:n("info.dept",{ns:"new form"}),content:t==="addForm"?c==="en"?a.DeptName_E:a.DeptName:s==null?void 0:s.dept}),e.jsx(S,{title:n("info.emp",{ns:"new form"}),content:t==="addForm"?l(a):s==null?void 0:s.EmpName})]})},pe=()=>{const{t}=j("common");function s(n){switch(n){case"未簽核":return t("signStatus.no");case"簽核中":return t("signStatus.ing");case"已完簽":return t("signStatus.done");case"退簽":return t("signStatus.return");case"作廢":return t("signStatus.void");default:return t("signStatus.ing")}}function i(n){switch(n){case 0:return t("signStatus.no");case 1:return t("signStatus.agree");case 3:return t("signStatus.return");case 4:return t("signStatus.void");case 5:return"";default:return t("signStatus.no")}}return{getFormStatus:s,getSignStatus:i}},G=""+new URL("excel_icon-2c17d34a.svg",import.meta.url).href,K=""+new URL("word_icon-5a31905a.svg",import.meta.url).href,Y=""+new URL("ppt_icon-89a14cad.svg",import.meta.url).href,q=""+new URL("pdf_icon-f2b4319a.svg",import.meta.url).href,J=""+new URL("img_icon-9ca6055d.svg",import.meta.url).href,E=""+new URL("file_icon-9a5f3f8f.svg",import.meta.url).href,_=[{id:"word",type:{doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}},{id:"ppt",type:{ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}},{id:"excel",type:{xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}},{id:"pdf",type:{pdf:"application/pdf"}},{id:"img",type:{jpg:"image/jpeg",png:"image/png"}}],T=()=>{const t=g(o=>o.files).body,s=g(o=>o.nowUser).body,i=g(o=>o.formInfo).body;async function n(o){for(const m of t.newFile){const r=new FormData;r.append("formId",o),r.append("EmpId",s.EmpId),r.append("fileName",m.name),r.append("webName","BusinessTrip"),r.append("SIGNORDER",i.nowOrder.toString()),r.append("file",m),console.log(r),N.uploadFileSign(r)}}function c(o){return o<=1e3?`${o} Byte`:o<=1e3*1e3?`${(o/1024).toFixed(1)} KB`:`${(o/1024/1024).toFixed(1)} MB`}function a(o){const m=_.find(p=>Object.values(p.type).some(x=>x===o));if(!m)return{type:"",src:""};let r;switch(m.id){case"img":r=J;break;case"word":r=K;break;case"ppt":r=Y;break;case"excel":r=G;break;case"pdf":r=q;break;case"normal":r=E;break;default:r=E;break}return{type:m.id,src:r}}function l(o){const m={};for(const r of o){const p=_.find(w=>w.id===r);if(!p)return;const x=Object.entries(p.type);for(const w of x)m[w[1]]=[`.${w[0]}`]}return m}const f=u.useCallback(o=>{function m(r){const p=r.split(".")[r.split(".").length-1],x=_.find(C=>Object.keys(C.type).some(R=>R===p));return x?x.type[p]:""}return m(o)},[]),d=u.useCallback(o=>{async function m(r){return await N.downloadFile(r)}return m(o)},[]);return{uploadFile:n,getDropzoneAccept:l,getFileSize:c,getFileType:a,path2blob:d,name2mine:f}},Q=({file:t,className:s,index:i,d:n,type:c})=>{const{t:a}=j("new form"),{getFileSize:l,getFileType:f}=T(),d=URL.createObjectURL(t);return e.jsxs("section",{className:s,children:[e.jsx("img",{src:f(t.type).src,alt:"顯示圖案"}),e.jsxs("div",{className:"content",children:[e.jsx("h3",{className:"title",children:t.name}),e.jsx("p",{className:"size",children:`size: ${l(t.size)}`}),c==="addForm"&&e.jsx("button",{type:"button",onClick:()=>{n(i)},children:e.jsx(F,{icon:e.jsx(D,{size:"1.25rem"}),children:a("attach.delete")})}),c==="sign"&&e.jsx("a",{href:d,download:!0,children:e.jsx("button",{type:"button",children:e.jsx(F,{icon:e.jsx(M,{size:"1.25rem"}),children:a("attach.download")})})})]})]})},k=L(Q)`
  display: flex;
  padding: 1rem 2rem;
  gap: 2rem;
  img {
    width: 4rem;
  }
  .content{
    display: flex;
    flex-flow: column;
    justify-content: space-between;
    gap: .5rem;
  }
  .title {
    font-size: 1.25rem;
  }
  .size {
    font-size: large.8rem;
    padding-left: 0.5rem;
    color: ${t=>t.theme.color.sectionHeader};
  }
  button {
    padding: 0;
    max-width: 15rem;
  }
`,fe=({type:t})=>{const{t:s}=j("new form",{keyPrefix:"attach"}),i=g(r=>r.files),n=v(),c=i.body.newFile,a=i.body.formAttach,[l,f]=u.useState([]),{name2mine:d,path2blob:o}=T();u.useEffect(()=>{(async function(){const r=await Promise.all(a.map(async(p,x)=>{const w=await o(p.FilePath);return new File([w],`${p.WebID} - ${x+1}`,{type:d(p.FileName)})}));r.length!==0&&f(r)})()},[a,d,o]);function m(r){n(P(r))}return e.jsxs("section",{className:`grid ${t==="addForm"?"grid-cols-1":"grid-cols-1 md:grid-cols-2"}`,children:[e.jsxs("div",{className:"w-full",children:[e.jsxs("p",{children:[s("new")," : "]}),e.jsx("article",{className:`${t==="addForm"?"grid grid-cols-1 sm:grid-cols-2":"grid grid-cols-1"}`,children:c.map((r,p)=>e.jsx(k,{file:r,index:p,d:m,type:"addForm"},p))})]}),t==="sign"&&e.jsxs("div",{className:"w-full",children:[e.jsxs("p",{children:[s("old")," : "]}),e.jsx("article",{className:"grid grid-cols-1",children:l.map((r,p)=>e.jsx(k,{file:r,index:p,type:"sign"},p))})]})]})},he=({type:t,main:s,sub:i,remove:n,index:c})=>{var r;const{t:a}=j("list page"),l=(r=I())==null?void 0:r.color,[f,d]=u.useState(!0),o=v();function m(){o(A(c)),n&&n()}return e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"header flex justify-between",children:[s,e.jsxs("div",{className:"flex flex-col sm:flex-row-reverse justify-center",children:[t==="addForm"&&e.jsx("button",{type:"button",onClick:m,children:e.jsx(D,{size:"1.25rem"})}),e.jsxs("button",{type:"button",className:"flex items-center justify-center gap-1",style:{color:l.blue},onClick:()=>{d(p=>!p)},children:[e.jsx("span",{style:{rotate:f?"0deg":".5turn",transition:"rotate .5s ease"},className:"scale-150 sm:scale-100",children:e.jsx(B,{color:l.blue})}),e.jsx("span",{className:"hidden sm:inline-block",children:a("detail.toggle")})]})]})]}),e.jsx("div",{className:"bottom",style:{height:f?"auto":0,overflowY:"hidden",transition:"height 1s ease"},children:e.jsx("div",{className:"mt-2 border-t-4 pt-4",children:i})})]})},h=t=>{const i=g(a=>a.modalControl).body[t],n=v();function c(a){let l;a==="on"?l=!0:a==="off"&&(l=!1),n(O({name:t,status:l}))}return[c,i]},X=({data:t,index:s})=>{const{i18n:i}=j(),n=i.language,c=v();console.log(t);const[a,l]=u.useState([]),f=u.useCallback(d=>async function(){const m=(await N.getEvent("TripEvent")).find(r=>r.ResourcesId===d);return m?n==="en"?m.ResourcesName_E:m.ResourcesName:""}(),[n]);return u.useEffect(()=>{(async function(){if(!t){l([]);return}const d=await Promise.all(t.map(async o=>({...o,purposeName:await f(o.purpose)})));l(d)})()},[t,f,s]),a.map((d,o)=>e.jsxs("tr",{children:[e.jsx("td",{children:o+1}),e.jsx("td",{children:d.district}),e.jsx("td",{children:d.city}),e.jsx("td",{children:d.purposeName}),e.jsx("td",{children:d.cus}),e.jsx("td",{children:d.hotel}),e.jsx("td",{children:d.PS}),e.jsx("td",{className:"cursor-pointer",onClick:()=>{c(U(s+1))},children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(D,{size:"1.25rem"})})})]},o))},Z=({data:t})=>t.map((s,i)=>e.jsxs("tr",{children:[e.jsx("td",{children:i+1}),e.jsx("td",{children:s.data.district}),e.jsx("td",{children:s.data.city}),e.jsx("td",{children:s.data.purpose}),e.jsx("td",{children:s.data.cus}),e.jsx("td",{children:s.data.hotel}),e.jsx("td",{children:s.data.PS})]},i)),xe=({type:t,data:s,index:i})=>{var m;const{t:n}=j("list page",{keyPrefix:"detailTable"}),c=(m=I())==null?void 0:m.color,[a]=h("newDetail"),[l,f]=u.useState(!1),d=s==null?void 0:s.data;u.useEffect(()=>{d&&d.length!==0?f(!0):f(!1)},[d]);const o=v();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"title flex items-center justify-between px-4 py-2",style:{backgroundColor:c.sectionHeader,color:c.white},children:[e.jsx("p",{children:n("title")}),t==="addForm"&&e.jsxs("button",{type:"button",className:"px-4 py-1 ring-1",style:{borderColor:c.white},onClick:()=>{o($((i||0)+1)),a("on")},children:["+",n("add")]})]}),e.jsx(V,{children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("td",{children:n("thead.index")}),e.jsx("td",{children:n("thead.dist")}),e.jsx("td",{children:n("thead.city")}),e.jsx("td",{children:n("thead.purpose")}),e.jsx("td",{children:n("thead.cus")}),e.jsx("td",{children:n("thead.lodging")}),e.jsx("td",{children:n("thead.PS")}),t==="addForm"&&e.jsx("td",{children:n("thead.delete")})]})}),e.jsx("tbody",{children:t==="addForm"?l?e.jsx(X,{data:d,index:i}):e.jsx("tr",{children:e.jsx("td",{colSpan:8,children:"no data"})}):e.jsx(Z,{data:s})})]})})]})},ge=({children:t})=>e.jsx("div",{className:"rounded-md px-8 py-4 ring-2 ring-gray-300",children:t}),je=({children:t})=>{const[s,i]=u.useState(!1);return e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"md:hidden",onClick:()=>{i(n=>!n)},children:e.jsx("button",{type:"button",children:e.jsx(F,{icon:e.jsx(H,{size:"1.25rem"}),children:"功能清單"})})}),e.jsx("ul",{className:`flex flex-col gap-2 md:flex-row
        ${s?"max-h-60 py-2":"max-h-0 py-0"} 
        absolute overflow-y-hidden md:relative md:max-h-60 md:transition-none`,style:{transition:"max-height .2s linear, padding .3s"},children:t})]})},y=({name:t,children:s})=>{const[i,n]=h(t);function c(a){var l;((l=a.target)==null?void 0:l.id)===`${t}-background`&&i("off")}return e.jsx("div",{id:`${t}-background`,className:"px-2 fixed inset-0 z-10 flex h-full w-full items-start justify-center overflow-auto bg-stone-800/75 pt-[15vh]",style:{display:n?"flex":"none"},onClick:c,children:e.jsx("div",{className:"w-full sm:w-2/3 lg:w-1/2",children:s})})},ee=()=>{const t=document.documentElement,s=()=>{t.style.overflow="hidden"},i=()=>{t.style.overflow="auto"};return{canScroll:c=>{c?i():s()}}},te=u.lazy(()=>b(()=>import("./new detail-d6261906.js"),["./new detail-d6261906.js","./index-cdc06e8f.js","./index-8c288d29.css","./select-a3bc1532.js","./react-select-async.esm-07ce7071.js","./use-isomorphic-layout-effect.browser.esm-f3ecf19c.js","./index.esm-0fe4b9cd.js","./required-14b49207.js","./index.esm-c3f04e89.js","./main-a582b553.js"],import.meta.url)),se=u.lazy(()=>b(()=>import("./confirm-5861c2ca.js"),["./confirm-5861c2ca.js","./index-cdc06e8f.js","./index-8c288d29.css","./week tabel-c053de75.js","./main-a582b553.js","./index.esm-0fe4b9cd.js","./data-3f69d374.js"],import.meta.url)),ne=u.lazy(()=>b(()=>import("./upload files-8f73f7a6.js"),["./upload files-8f73f7a6.js","./index-cdc06e8f.js","./index-8c288d29.css","./main-a582b553.js","./index-e68c65af.js","./index.esm-0fe4b9cd.js"],import.meta.url)),re=u.lazy(()=>b(()=>import("./sign box-80c0e7ee.js"),["./sign box-80c0e7ee.js","./index-cdc06e8f.js","./index-8c288d29.css","./index.esm-0fe4b9cd.js","./main-a582b553.js","./use-isomorphic-layout-effect.browser.esm-f3ecf19c.js","./required-14b49207.js","./index.esm-c3f04e89.js","./sign-09783438.js"],import.meta.url)),oe=u.lazy(()=>b(()=>import("./other sign block-2623183e.js"),["./other sign block-2623183e.js","./index-cdc06e8f.js","./index-8c288d29.css","./react-select-async.esm-07ce7071.js","./use-isomorphic-layout-effect.browser.esm-f3ecf19c.js","./index.esm-0fe4b9cd.js","./index.esm-c3f04e89.js","./sign-09783438.js","./main-a582b553.js"],import.meta.url)),ie=u.lazy(()=>b(()=>import("./void modal-94f0dfb6.js"),["./void modal-94f0dfb6.js","./index-cdc06e8f.js","./index-8c288d29.css","./index.esm-0fe4b9cd.js","./sign-09783438.js","./main-a582b553.js"],import.meta.url)),ae=u.lazy(()=>b(()=>import("./errors-f1447332.js"),["./errors-f1447332.js","./index-cdc06e8f.js","./index-8c288d29.css","./index.esm-0fe4b9cd.js","./main-a582b553.js"],import.meta.url)),we=()=>{const t=g(r=>r.errors),s=g(r=>r.formInfo).body,i=h("errors")[1],n=h("newDetail")[1],c=h("review")[1],a=h("files")[1],l=h("sign")[1],f=h("otherSign")[1],d=h("void")[1],o=[i,n,c,a,l,f,d],{canScroll:m}=ee();return o.some(r=>r===!0)?m(!1):m(!0),e.jsxs(u.Suspense,{children:[n&&e.jsx(y,{name:"newDetail",children:e.jsx(te,{})}),c&&e.jsx(y,{name:"review",children:e.jsx(se,{})}),a&&e.jsx(y,{name:"files",children:e.jsx(ne,{})}),l&&e.jsx(y,{name:"sign",children:e.jsx(re,{type:s.signType})}),f&&e.jsx(y,{name:"otherSign",children:e.jsx(oe,{})}),d&&e.jsx(y,{name:"void",children:e.jsx(ie,{})}),i&&e.jsx(y,{name:"errors",children:e.jsx(ae,{errors:t.body})})]})};var ce=(t=>(t.atu="TripEvent-5",t.oldCus="TripEvent-6",t.newCus="TripEvent-7",t))(ce||{});export{fe as A,ge as B,he as C,xe as D,je as H,ue as I,we as P,T as a,h as b,pe as c,ce as t,W as u};
