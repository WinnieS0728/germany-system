import{r as j,a2 as C,aa as w,e as E,j as t,t as v,ab as L,H as B,S as M,U as I,I as b,ac as P,ad as H,Z as F,ae as R,$ as A,a0 as z,a1 as W,af as $,ag as O}from"./index-9a1a6fd5.js";import{B as x,I as Y,C as U,D as Z}from"./block-61d7e6e5.js";import{H as _}from"./header-8d9478e7.js";import{M as q}from"./main-d974c04c.js";const G={id:"",createDate:"",status:"",company:"",dept:"",EmpId:"",EmpName:"",transportation:"",isLodging:"",stayDays:"",days:"",money:"",agent:""},J=n=>{const[o,g]=j.useState(G),[c,r]=j.useState([]),D=j.useCallback(()=>{async function a(e){return await C.getBusinessApplyHeader(e)}return a(n)},[n]),h=j.useCallback(()=>{async function a(e){return await C.getBusinessApplyDetail(e)}return a(n)},[n]),m=j.useCallback(a=>{async function e(){return await C.getMember(a)}return e()},[]);return j.useEffect(()=>{async function a(){const e=await D(),l=await h(),d=await m(e[0].Createid);function N(s){return s==="N"?"No":s==="Y"?"Yes":""}function k(s,i){return s==="0"?s:`${s} (${i})`}function u(s){const i=[],y=E.count(new Date(s.startDate),new Date(s.endDate))+1;for(let f=0;f<y;f++)i.push(w(E.offset(new Date(s.startDate),f)));return i}const p={id:e[0].BTPId,createDate:w(e[0].Createdate.split(" ")[0]),status:e[0].status,company:d[0].ResourcesName,dept:d[0].DeptName,EmpId:d[0].EmpId,EmpName:d[0].EmpName,transportation:e[0].ResourcesName,isLodging:N(e[0].IsLodging),stayDays:e[0].StayDays,days:e[0].Days,money:k(e[0].Advance_Amount,e[0].Curr),agent:e[0].DeputyEmpName||"無人回應"};g(p);const S=l.map((s,i)=>({id:i+1,date:u({startDate:w(s.StartDT.split(" ")[0]),endDate:w(s.EndDT.split(" ")[0])}),data:{district:s.Area,city:s.City,purpose:s.ResourcesName,cus:s.CustName,hotel:s.Hotel,PS:s.Description}})),T=[...new Set(S.map(s=>S.filter(i=>i.date.every((y,f)=>y===s.date[f]))).map(s=>s.map(i=>i.id).join(",")))].map(s=>s.split(",").map(i=>S.find(y=>y.id===parseInt(i))));r(T)}a()},[n,h,D,m]),{headData:o,detailData:c}},K=({data:n})=>t.jsxs("article",{className:"flex items-center justify-center gap-20",children:[t.jsxs("div",{className:"w-full text-center",children:["交通工具 : ",n.transportation]}),t.jsxs("div",{className:"w-full text-center",children:["出差總天數 : ",n.days]}),t.jsxs("div",{className:"w-full text-center",children:["是否住宿 : ",n.isLodging]}),t.jsxs("div",{className:"w-full text-center",children:["住宿總天數 : ",n.stayDays]})]}),Q=({data:n})=>{const o=n[0].date;return t.jsxs("div",{className:"flex items-center justify-center gap-12",children:[t.jsxs("p",{children:["出差日期(起) : ",o[0]]}),t.jsxs("p",{children:["出差日期(迄) : ",o[o.length-1]]})]})},V=(n,o)=>{const g=()=>{const a=[];for(let e=0;e<7;e++)a.push(w(E.offset(v(new Date(o)),e+7)));return a},c=n.reduce((a,e)=>a.concat(e),[]),r=g().map(a=>c.filter(e=>e.date.some(l=>l===a)).sort((e,l)=>l.date.length-e.date.length)),D=Math.max(r[0].length,r[1].length,r[2].length,r[3].length,r[4].length,r[5].length,r[6].length);function h(a){const e={id:0,date:[],data:{district:"",city:"",purpose:"",cus:"",hotel:"",PS:""}};return r.map(d=>d[a]?d[a]:e)}const m=[];for(let a=0;a<D;a++)m.push(h(a));return{nextWeekDays:g(),rows:m,spreadData:c}},at=()=>{var d,N,k;const{formId:n}=L(),o=(d=B())==null?void 0:d.color,g=M(),{headData:c,detailData:r}=J(n),D=V(r,c.createDate),h=r.reduce((u,p)=>u.concat(p),[]).sort((u,p)=>m(u.date)-m(p.date));function m(u){return new Date(u[0]).getTime()}const a={year:(N=h[0])==null?void 0:N.date[0].split("-")[0],month:(k=h[0])==null?void 0:k.date[0].split("-")[1]},[e]=I("sign"),[l]=I("otherSign");return t.jsxs(t.Fragment,{children:[t.jsx(_,{title:"國內外出差申請單"}),t.jsx(q,{className:"main-section-gap",children:t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"top-btn-list",children:[t.jsx("button",{type:"button",onClick:()=>{e("on")},children:t.jsx(b,{icon:t.jsx(P,{size:"1.5rem",color:o.white}),primary:!0,children:"簽核表單"})}),t.jsx("button",{type:"button",onClick:()=>{l("on")},children:t.jsx(b,{icon:t.jsx(H,{size:"1.5rem",color:o.white}),primary:!0,children:"會簽(意見徵詢)"})}),t.jsx("button",{type:"button",children:t.jsx(b,{icon:t.jsx(F,{size:"1.5rem"}),children:"加入附件"})}),t.jsx("button",{type:"button",children:t.jsx(b,{icon:t.jsx(R,{size:"1.5rem",color:o.black}),children:"列印"})}),t.jsx("button",{type:"button",children:t.jsx(A,{to:"https://esys.orange-electronic.com/Eform/List",children:t.jsx(b,{icon:t.jsx(z,{size:"1.25rem"}),children:"返回列表"})})})]}),t.jsxs(W,{...g,children:[t.jsx(x,{children:t.jsx(Y,{type:"sign",data:c})}),t.jsx(x,{children:t.jsx(K,{data:c})}),t.jsx(x,{children:t.jsxs("div",{className:"space-y-4",children:[t.jsx($,{data:D}),t.jsx(O,{data:r,EmpId:c.EmpId,time:a})]})}),r.map((u,p)=>t.jsx(x,{children:t.jsx(U,{type:"sign",main:t.jsx(Q,{data:u}),sub:t.jsx(Z,{type:"sign",data:u,index:p})})},p)),t.jsx(x,{children:t.jsxs("p",{children:["預支差旅費 : ",c.money]})}),t.jsx(x,{children:t.jsxs("p",{children:["代理人 : ",c.agent]})}),t.jsx(x,{children:t.jsx("p",{children:"表單附件 : "})})]})]})})]})};export{at as default};
