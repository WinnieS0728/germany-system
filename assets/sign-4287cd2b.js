import{b as y,j as e,x as A,d as z,t as H,H as F,u as f,r as x,F as W,a as U,A as V,G as _,I as J,J as K,K as q,L as S}from"./index-64ebcfb1.js";import{c as Q,I as u,f as X,O as Y,A as Z,g as M,B as ee,V as te,F as se}from"./index.esm-8e5cdf44.js";import{a as b,P as ne,H as ae,B as g,I as re,C as ie,D as oe,A as ce}from"./popup-b0faad0b.js";import{H as le}from"./header-7eafef48.js";import{s as de,M as me}from"./main-95402293.js";import{u as pe}from"./data-2569dfeb.js";import{W as he,P as xe}from"./week tabel-c56fa2f2.js";import{u as ue,a as ge}from"./status translate-8e2cd280.js";const je=({data:n})=>{const{t:a}=y("new form");return e.jsxs("article",{className:"grid grid-cols-2 items-center justify-center gap-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"w-full text-center",children:[a("transport.transportation")," : ",n.transportation]}),e.jsxs("div",{className:"w-full text-center",children:[a("transport.tripDay")," : ",n.days]}),e.jsxs("div",{className:"w-full text-center",children:[a("transport.isStay")," : ",n.isLodging]}),e.jsxs("div",{className:"w-full text-center",children:[a("transport.stayDay")," : ",n.stayDays]})]})},fe=({data:n})=>{const{t:a}=y("list page"),o=n[0].date;return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 sm:flex-row sm:gap-6 md:gap-12",children:[e.jsxs("p",{children:[a("detail.startDate")," :",e.jsxs("span",{style:{whiteSpace:"nowrap"},children:[" ",o[0]]})," "]}),e.jsxs("p",{children:[a("detail.endDate")," :",e.jsxs("span",{style:{whiteSpace:"nowrap"},children:[" ",o[o.length-1]]})]})]})},be=(n,a)=>{const o=()=>{const i=[];for(let r=0;r<7;r++)i.push(A(z.offset(H(new Date(a)),r+7)));return i},d=n.reduce((i,r)=>i.concat(r),[]),s=o().map(i=>d.filter(r=>r.date.some(t=>t===i)).sort((r,t)=>t.date.length-r.date.length)),m=Math.max(s[0].length,s[1].length,s[2].length,s[3].length,s[4].length,s[5].length,s[6].length);function j(i){const r={id:0,date:[],data:{district:"",city:"",purpose:"",cus:"",hotel:"",PS:""}};return s.map(l=>l[i]?l[i]:r)}const p=[];for(let i=0;i<m;i++)p.push(j(i));return{nextWeekDays:o(),rows:p,spreadData:d}},ye=({order:n})=>{const a=f(s=>s.files).body.formAttach,{formId:o}=f(s=>s.formInfo).body,d=a.map((s,m)=>({...s,show:`${o}-${m+1}`})).filter(s=>parseInt(s.SIGNORDER)===n);return e.jsx("ul",{children:d.map((s,m)=>e.jsx("li",{style:{whiteSpace:"nowrap"},children:s.show},m))})},Se=()=>{var i,r;const{t:n}=y("sign page"),a=(i=F())==null?void 0:i.color,{signList:o}=f(t=>t.formInfo).body,[d,s]=x.useState(o),{id2name:m}=ue(),{getSignStatus:j}=ge();function p(t){return t==="會簽"}return x.useEffect(()=>{(async function(){const t=await Promise.all(o.map(async l=>({...l,SIGNERNAME:await m(l.SIGNER)})));s(t)})()},[o,m]),e.jsxs("section",{children:[e.jsx("h3",{className:"header",style:{backgroundColor:a.sign_header,textAlign:"center",padding:".5rem"},children:n("table.title")}),e.jsx(de,{children:e.jsxs("table",{children:[e.jsx("thead",{style:{backgroundColor:a.tableBgc},children:e.jsxs("tr",{children:[e.jsx("td",{children:n("table.index")}),e.jsx("td",{children:n("table.step")}),e.jsx("td",{children:n("table.emp")}),e.jsx("td",{children:n("table.image")}),e.jsx("td",{children:n("table.status")}),e.jsx("td",{children:n("table.date")}),e.jsx("td",{children:n("table.opinion")}),e.jsx("td",{children:n("table.attach")})]})}),e.jsx("tbody",{children:(r=d.slice(1))==null?void 0:r.map((t,l)=>e.jsxs("tr",{children:[e.jsx("td",{children:t.SIGNORDER}),e.jsx("td",{children:`${p(t.SignGroup)?"會簽 -":""} ${t.STEPNAME}`}),e.jsx("td",{children:t.SIGNERNAME}),e.jsx("td",{children:(t.SIGNRESULT===1||t.SIGNRESULT===3)&&e.jsx("span",{className:"flex items-center justify-center",children:e.jsx("img",{alt:"簽名圖片",src:`https://esys.orange-electronic.com/Image/SignerPicture/${t.SIGNER}.png`})})}),e.jsx("td",{children:j(t.SIGNRESULT)}),e.jsx("td",{style:{whiteSpace:"nowrap"},children:t.SIGNTIME&&A(t.SIGNTIME)}),e.jsx("td",{children:t.OPINION}),e.jsx("td",{children:e.jsx(ye,{order:t.SIGNORDER})})]},l))})]})})]})},Ge=()=>{var E,k,R,T,G;const{formId:n}=W(),{t:a}=y(["common","sign page","new form"]),{signList:o,nextSign:d}=f(c=>c.formInfo).body,s=f(c=>c.nowUser).body,[m,j]=x.useState(!1),p=(E=F())==null?void 0:E.color,i=Q(),r=U(),{headData:t,detailData:l}=pe(),P=be(l,t.createDate),[L]=b("void"),[v]=b("sign"),[C]=b("otherSign"),[O]=b("files"),$=x.useMemo(()=>!!o.some(c=>c.SIGNER===s.EmpId),[o,s.EmpId]),I=x.useMemo(()=>(d==null?void 0:d.SIGNER)===s.EmpId,[d,s.EmpId]),w=x.useMemo(()=>t.status==="作廢",[t.status]);x.useEffect(()=>{(async function(){(await V.getMemberGroup(s.EmpId)).find(h=>h.GroupID==="admin")&&j(!0)})()},[s]),x.useEffect(()=>{r(_(n)),r(J(n)),r(K(n)),r(q(n))},[r,n]);function D(c){return new Date(c[0]).getTime()}const N=l.reduce((c,h)=>c.concat(h),[]).sort((c,h)=>D(c.date)-D(h.date)),B={year:(R=(k=N[0])==null?void 0:k.date[0])==null?void 0:R.split("-")[0],month:(G=(T=N[0])==null?void 0:T.date[0])==null?void 0:G.split("-")[1]};return e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),e.jsx(le,{title:a("title.businessTripApply",{ns:"common"})}),e.jsx(me,{className:"main-section-gap",children:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"top-btn-list",children:[I&&!w&&e.jsx(ae,{children:e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>{v("on")},children:e.jsx(u,{icon:e.jsx(X,{size:"1.5rem",color:p.white}),primary:!0,children:a("btn.sign",{ns:"sign page"})})}),e.jsx("button",{type:"button",onClick:()=>{C("on")},children:e.jsx(u,{icon:e.jsx(Y,{size:"1.5rem",color:p.white}),primary:!0,children:a("btn.otherSign",{ns:"sign page"})})}),e.jsx("button",{type:"button",onClick:()=>{O("on")},children:e.jsx(u,{icon:e.jsx(Z,{size:"1.5rem"}),children:a("btn.attach",{ns:"sign page"})})}),e.jsx("button",{type:"button",children:e.jsx(S,{to:`../../print/${n}?userID=${s.EmpId}`,target:"_blank",children:e.jsx(u,{icon:e.jsx(M,{size:"1.5rem",color:p.black}),children:a("btn.print",{ns:"sign page"})})})})]})}),$&&!I&&e.jsx("button",{type:"button",children:e.jsx(S,{to:`../../print/${n}?userID=${s.EmpId}`,target:"_blank",children:e.jsx(u,{icon:e.jsx(M,{size:"1.5rem",color:p.black}),children:a("btn.print",{ns:"sign page"})})})}),e.jsx("button",{type:"button",children:e.jsx(S,{to:"/apply",children:e.jsx(u,{icon:e.jsx(ee,{size:"1.25rem"}),children:a("btn.back",{ns:"sign page"})})})}),m&&!w&&e.jsx("button",{type:"button",onClick:()=>{L("on")},children:e.jsx(u,{icon:e.jsx(te,{size:"1.25rem"}),children:a("btn.void",{ns:"sign page"})})})]}),e.jsxs(se,{...i,children:[e.jsx(g,{children:e.jsx(re,{type:"sign",data:t})}),e.jsx(g,{children:e.jsx(je,{data:t})}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(he,{data:P}),e.jsx(xe,{data:l,EmpId:t.EmpId,time:B})]})}),l.map((c,h)=>e.jsx(g,{children:e.jsx(ie,{type:"sign",main:e.jsx(fe,{data:c}),sub:e.jsx(oe,{type:"sign",data:c,index:h})})},h)),e.jsx(g,{children:e.jsxs("p",{children:[a("money.amount",{ns:"new form"})," : ",t.money]})}),e.jsx(g,{children:e.jsxs("p",{children:[a("deputy.deputy",{ns:"new form"})," : ",t.agent]})}),e.jsx(g,{children:e.jsx(ce,{type:"sign"})})]}),e.jsx(Se,{})]})})]})};export{Ge as default};
