import{b as R,r as o,A as g,u as H,x as D,d as L}from"./index-64ebcfb1.js";import{u as A,a as P}from"./status translate-8e2cd280.js";const q=()=>{const{i18n:l}=R(),m=l.language;return{id2transportation:o.useCallback(n=>async function(){const r=(await g.getEvent("Traffic")).find(f=>f.ResourcesId===n);return m==="en"?r==null?void 0:r.ResourcesName_E:r==null?void 0:r.ResourcesName}(),[m])}},F={id:"",createDate:"",status:"",company:"",dept:"",EmpId:"",EmpName:"",transportation:"",isLodging:"",stayDays:"",days:"",money:"",agent:""},$=()=>{const{i18n:l,t:m}=R("sign page"),c=l.language,{formId:n}=H(s=>s.formInfo).body,[w,r]=o.useState(F),[f,v]=o.useState([]),{id2name:E}=A(),{id2transportation:I}=q(),{getFormStatus:N}=P(),S=o.useCallback(()=>{async function s(e){return await g.getBusinessApplyHeader(e)}return s(n)},[n]),T=o.useCallback(()=>{async function s(e){return await g.getBusinessApplyDetail(e)}return s(n)},[n]),b=o.useCallback(s=>{async function e(){return await g.getMember(s)}return e()},[]),{splitName:C}=A();return o.useEffect(()=>{async function s(){const e=await S(),d=await T(),i=await b(e[0].Createid);function _(t){return t==="N"?"No":t==="Y"?"Yes":""}function h(t,a){return t==="0"?t:`${t} (${a})`}function k(t){const a=[],u=L.count(new Date(t.startDate),new Date(t.endDate))+1;for(let p=0;p<u;p++)a.push(D(L.offset(new Date(t.startDate),p)));return a}const x={id:e[0].BTPId,createDate:D(e[0].Createdate.split(" ")[0]),status:N(e[0].status),company:c==="en"?i[0].ResourcesName_E:i[0].ResourcesName,dept:c==="en"?i[0].DeptName_E:i[0].DeptName,EmpId:i[0].EmpId,EmpName:C(i[0]),transportation:await I(e[0].Transport),isLodging:_(e[0].IsLodging),stayDays:e[0].StayDays,days:e[0].Days,money:h(e[0].Advance_Amount,e[0].Curr),agent:await E(e[0].Deputy)};r(x);const y=d.map((t,a)=>({id:a+1,date:k({startDate:D(t.StartDT.split(" ")[0]),endDate:D(t.EndDT.split(" ")[0])}),data:{district:t.Area,city:t.City,purpose:c==="en"?t.ResourcesName_E:t.ResourcesName,eventId:t.TripEvent,cus:t.CustName,hotel:t.Hotel,PS:t.Description}})),B=[...new Set(y.map(t=>y.filter(a=>a.date.every((u,p)=>u===t.date[p]))).map(t=>t.map(a=>a.id).join(",")))].map(t=>t.split(",").map(a=>y.find(u=>u.id===parseInt(a))));v(B)}n&&s()},[n,T,N,S,b,E,I,c,C,m]),{headData:w,detailData:f}};export{$ as u};
