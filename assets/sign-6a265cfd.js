import{b as O,u as f,a as M,r as h,v as G,A as i,Q as p,z as m}from"./index-d92dbf70.js";const L=()=>{const{t:o}=O("toast"),n=f(t=>t.formInfo).body,a=f(t=>t.nowUser).body,S=M(),d=h.useMemo(()=>{var e;const t=n.nowOrder,s=(e=n.signList[n.signList.length-1])==null?void 0:e.SIGNORDER;return t===s},[n]);async function I(t){let s,e="";if(t==="delete"?(s={BTPId:n.formId,Status:"4",type:"1"},e=o("formStatus.void"),u()):t==="no"?(s={BTPId:n.formId,Status:"3",type:"1"},e=o("formStatus.return")):t==="yes"&&d&&(s={BTPId:n.formId,Status:"2",type:"1"},e=o("formStatus.done")),!s)return;const c=i.updateForm(s);p.promise(c,{pending:o("formStatus.pending"),success:`${n.formId} ${e}`,error:o("formStatus.fail")})}function l(t){return t==="yes"?1:t==="no"?3:0}const N=G();function u(){setTimeout(()=>{N("../apply")},1e3)}async function E(t){const s={...n.nextSign,ACTUALNAME:a.EmpName,ACTUALSIGNER:a.EmpId,SIGNRESULT:l(t.agree),OPINION:t.opinion,SIGNTIME:"",types:"1",ExceId:a.EmpId},e=i.updateSignStatus(s);p.promise(e,{pending:o("sign.pending"),success:o("sign.success"),error:o("sign.fail")}),S(m()),u()}function g(t){return parseInt(t.Title.split("-")[0])}async function T(t){const e=(await Promise.all(t.map(async r=>(await i.getMember(r))[0]))).sort((r,A)=>g(r)-g(A)).map(r=>({FORMNO:n.formId,SIGNORDER:n.nowOrder,STEPNAME:r.DeptName,SIGNER:r.EmpId,SIGNERNAME:r.EmpName,OPINION:"",SignGroup:"會簽"})),c=i.postOtherSign(e);p.promise(c,{pending:o("otherSign.pending"),success:o("otherSign.success"),error:o("otherSign.fail")}),S(m()),u()}async function y(){const t=n.signList.slice(n.nowOrder+1);console.log(t);const s=t.map(e=>({...e,ACTUALNAME:"",ACTUALSIGNER:"",SIGNRESULT:5,types:"1",OPINION:"",SIGNTIME:"",ExceId:a.EmpId}));for(const e of s)(function(){i.updateSignStatus(e)})();console.log("已完簽")}return{sign:E,updateFormStatus:I,otherSign:T,signOver:y}};export{L as u};
