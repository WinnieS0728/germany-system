import{b as R,r as p,A as G,x as w,d as v,j as e,t as _,H,u as E,F as $,a as z,G as W,I as U,J as V,K as Y,L as J}from"./index-cdc06e8f.js";import{c as K,I as S,f as q,O as Q,A as X,g as Z,B as ee,V as te,F as se}from"./index.esm-0fe4b9cd.js";import{u as B,c as O,b as F,P as ne,H as ae,B as y,I as re,C as ie,D as oe,A as ce}from"./index-5ba49e3c.js";import{H as le}from"./header-e3c01ceb.js";import{s as de,M as ue}from"./main-a582b553.js";import{W as pe,P as me}from"./week tabel-c053de75.js";const ge={id:"",createDate:"",status:"",company:"",dept:"",EmpId:"",EmpName:"",transportation:"",isLodging:"",stayDays:"",days:"",money:"",agent:""},he=s=>{const{i18n:a,t:d}=R("sign page"),u=a.language,[o,m]=p.useState(ge),[h,f]=p.useState([]),{id2name:i}=B(),{getFormStatus:r}=O(),n=p.useCallback(()=>{async function x(l){return await G.getBusinessApplyHeader(l)}return x(s)},[s]),g=p.useCallback(()=>{async function x(l){return await G.getBusinessApplyDetail(l)}return x(s)},[s]),T=p.useCallback(x=>{async function l(){return await G.getMember(x)}return l()},[]),{splitName:k}=B();return p.useEffect(()=>{async function x(){const l=await n(),D=await g(),j=await T(l[0].Createid);function A(t){return t==="N"?"No":t==="Y"?"Yes":""}function L(t,c){return t==="0"?t:`${t} (${c})`}function P(t){const c=[],I=v.count(new Date(t.startDate),new Date(t.endDate))+1;for(let N=0;N<I;N++)c.push(w(v.offset(new Date(t.startDate),N)));return c}const M={id:l[0].BTPId,createDate:w(l[0].Createdate.split(" ")[0]),status:r(l[0].status),company:u==="en"?j[0].ResourcesName_E:j[0].ResourcesName,dept:u==="en"?j[0].DeptName_E:j[0].DeptName,EmpId:j[0].EmpId,EmpName:k(j[0]),transportation:l[0].ResourcesName_E,isLodging:A(l[0].IsLodging),stayDays:l[0].StayDays,days:l[0].Days,money:L(l[0].Advance_Amount,l[0].Curr),agent:await i(l[0].Deputy)};m(M);const b=D.map((t,c)=>({id:c+1,date:P({startDate:w(t.StartDT.split(" ")[0]),endDate:w(t.EndDT.split(" ")[0])}),data:{district:t.Area,city:t.City,purpose:u==="en"?t.ResourcesName_E:t.ResourcesName,eventId:t.TripEvent,cus:t.CustName,hotel:t.Hotel,PS:t.Description}})),C=[...new Set(b.map(t=>b.filter(c=>c.date.every((I,N)=>I===t.date[N]))).map(t=>t.map(c=>c.id).join(",")))].map(t=>t.split(",").map(c=>b.find(I=>I.id===parseInt(c))));f(C)}x()},[s,g,r,n,T,i,u,k,d]),{headData:o,detailData:h}},xe=({data:s})=>{const{t:a}=R("new form");return e.jsxs("article",{className:"grid grid-cols-2 items-center justify-center gap-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"w-full text-center",children:[a("transport.transportation")," : ",s.transportation]}),e.jsxs("div",{className:"w-full text-center",children:[a("transport.tripDay")," : ",s.days]}),e.jsxs("div",{className:"w-full text-center",children:[a("transport.isStay")," : ",s.isLodging]}),e.jsxs("div",{className:"w-full text-center",children:[a("transport.stayDay")," : ",s.stayDays]})]})},je=({data:s})=>{const{t:a}=R("list page"),d=s[0].date;return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 sm:flex-row sm:gap-6 md:gap-12",children:[e.jsxs("p",{children:[a("detail.startDate")," :",e.jsxs("span",{style:{whiteSpace:"nowrap"},children:[" ",d[0]]})," "]}),e.jsxs("p",{children:[a("detail.endDate")," :",e.jsxs("span",{style:{whiteSpace:"nowrap"},children:[" ",d[d.length-1]]})]})]})},fe=(s,a)=>{const d=()=>{const i=[];for(let r=0;r<7;r++)i.push(w(v.offset(_(new Date(a)),r+7)));return i},u=s.reduce((i,r)=>i.concat(r),[]),o=d().map(i=>u.filter(r=>r.date.some(n=>n===i)).sort((r,n)=>n.date.length-r.date.length)),m=Math.max(o[0].length,o[1].length,o[2].length,o[3].length,o[4].length,o[5].length,o[6].length);function h(i){const r={id:0,date:[],data:{district:"",city:"",purpose:"",cus:"",hotel:"",PS:""}};return o.map(g=>g[i]?g[i]:r)}const f=[];for(let i=0;i<m;i++)f.push(h(i));return{nextWeekDays:d(),rows:f,spreadData:u}},ye=({order:s})=>{const a=E(o=>o.files).body.formAttach,d=E(o=>o.formInfo).body,u=a.map((o,m)=>({...o,show:`${d.formId}-${m+1}`})).filter(o=>parseInt(o.SIGNORDER)===s);return e.jsx("ul",{children:u.map((o,m)=>e.jsx("li",{style:{whiteSpace:"nowrap"},children:o.show},m))})},De=()=>{var i,r;const{t:s}=R("sign page"),a=(i=H())==null?void 0:i.color,d=E(n=>n.formInfo).body,[u,o]=p.useState(d.signList),{id2name:m}=B(),{getSignStatus:h}=O();function f(n){return n==="會簽"}return p.useEffect(()=>{(async function(){const n=await Promise.all(d.signList.map(async g=>({...g,SIGNERNAME:await m(g.SIGNER)})));o(n)})()},[d.signList,m]),e.jsxs("section",{children:[e.jsx("h3",{className:"header",style:{backgroundColor:a.sign_header,textAlign:"center",padding:".5rem"},children:s("table.title")}),e.jsx(de,{children:e.jsxs("table",{children:[e.jsx("thead",{style:{backgroundColor:a.tableBgc},children:e.jsxs("tr",{children:[e.jsx("td",{children:s("table.index")}),e.jsx("td",{children:s("table.step")}),e.jsx("td",{children:s("table.emp")}),e.jsx("td",{children:s("table.image")}),e.jsx("td",{children:s("table.status")}),e.jsx("td",{children:s("table.date")}),e.jsx("td",{children:s("table.opinion")}),e.jsx("td",{children:s("table.attach")})]})}),e.jsx("tbody",{children:(r=u.slice(1))==null?void 0:r.map((n,g)=>e.jsxs("tr",{children:[e.jsx("td",{children:n.SIGNORDER}),e.jsx("td",{children:`${f(n.SignGroup)?"會簽 -":""} ${n.STEPNAME}`}),e.jsx("td",{children:n.SIGNERNAME}),e.jsx("td",{children:(n.SIGNRESULT===1||n.SIGNRESULT===3)&&e.jsx("span",{className:"flex items-center justify-center",children:e.jsx("img",{alt:"簽名圖片",src:`https://esys.orange-electronic.com/Image/SignerPicture/${n.SIGNER}.png`})})}),e.jsx("td",{children:h(n.SIGNRESULT)}),e.jsx("td",{style:{whiteSpace:"nowrap"},children:n.SIGNTIME&&w(n.SIGNTIME)}),e.jsx("td",{children:n.OPINION}),e.jsx("td",{children:e.jsx(ye,{order:n.SIGNORDER})})]},g))})]})})]})},Re=()=>{var M,b,C;const{formId:s}=$(),{t:a}=R(["common","sign page","new form"]),d=E(t=>t.formInfo).body,u=E(t=>t.nowUser).body,[o,m]=p.useState(!1),h=(M=H())==null?void 0:M.color,f=K(),i=z(),{headData:r,detailData:n}=he(s),g=fe(n,r.createDate),[T]=F("void"),[k]=F("sign"),[x]=F("otherSign"),[l]=F("files"),D=p.useMemo(()=>{var t;return((t=d.nextSign)==null?void 0:t.SIGNER)===u.EmpId},[d,u]),j=p.useMemo(()=>r.status==="作廢",[r.status]);p.useEffect(()=>{(async function(){(await G.getMemberGroup(u.EmpId)).find(c=>c.GroupID==="admin")&&m(!0)})()},[u]),p.useEffect(()=>{i(W(s)),i(U(s)),i(V(s)),i(Y(s))},[i,s]);function A(t){return new Date(t[0]).getTime()}const L=n.reduce((t,c)=>t.concat(c),[]).sort((t,c)=>A(t.date)-A(c.date)),P={year:(b=L[0])==null?void 0:b.date[0].split("-")[0],month:(C=L[0])==null?void 0:C.date[0].split("-")[1]};return e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),e.jsx(le,{title:a("title.businessTripApply",{ns:"common"})}),e.jsx(ue,{className:"main-section-gap",children:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"top-btn-list",children:[D&&!j&&e.jsx(ae,{children:e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>{k("on")},children:e.jsx(S,{icon:e.jsx(q,{size:"1.5rem",color:h.white}),primary:!0,children:a("btn.sign",{ns:"sign page"})})}),e.jsx("button",{type:"button",onClick:()=>{x("on")},children:e.jsx(S,{icon:e.jsx(Q,{size:"1.5rem",color:h.white}),primary:!0,children:a("btn.otherSign",{ns:"sign page"})})}),e.jsx("button",{type:"button",onClick:()=>{l("on")},children:e.jsx(S,{icon:e.jsx(X,{size:"1.5rem"}),children:a("btn.attach",{ns:"sign page"})})}),e.jsx("button",{type:"button",disabled:!0,children:e.jsx(S,{icon:e.jsx(Z,{size:"1.5rem",color:h.black}),children:a("btn.print",{ns:"sign page"})})})]})}),e.jsx("button",{type:"button",children:e.jsx(J,{to:"https://esys.orange-electronic.com/Eform/List",children:e.jsx(S,{icon:e.jsx(ee,{size:"1.25rem"}),children:a("btn.back",{ns:"sign page"})})})}),o&&!j&&e.jsx("button",{type:"button",onClick:()=>{T("on")},children:e.jsx(S,{icon:e.jsx(te,{size:"1.25rem"}),children:a("btn.void",{ns:"sign page"})})})]}),e.jsxs(se,{...f,children:[e.jsx(y,{children:e.jsx(re,{type:"sign",data:r})}),e.jsx(y,{children:e.jsx(xe,{data:r})}),e.jsx(y,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(pe,{data:g}),e.jsx(me,{data:n,EmpId:r.EmpId,time:P})]})}),n.map((t,c)=>e.jsx(y,{children:e.jsx(ie,{type:"sign",main:e.jsx(je,{data:t}),sub:e.jsx(oe,{type:"sign",data:t,index:c})})},c)),e.jsx(y,{children:e.jsxs("p",{children:[a("money.amount",{ns:"new form"})," : ",r.money]})}),e.jsx(y,{children:e.jsxs("p",{children:[a("deputy.deputy",{ns:"new form"})," : ",r.agent]})}),e.jsx(y,{children:e.jsx(ce,{type:"sign"})})]}),e.jsx(De,{})]})})]})};export{Re as default};
